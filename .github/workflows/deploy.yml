name: Deploy Multi-Branch HRIS and Gpro

on:
  push:
    branches: ["HRIS", "Gpro", "main"] # Jalan otomatis tiap ada update
  workflow_dispatch: # Bisa dijalankan manual

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # 1. Ambil file dari branch HRIS (Link Utama)
      - name: Checkout HRIS
        uses: actions/checkout@v4
        with:
          ref: HRIS
          path: hris-folder

      # 2. Ambil file dari branch Gpro (Link Sub-folder)
      - name: Checkout Gpro
        uses: actions/checkout@v4
        with:
          ref: Gpro
          path: gpro-folder

      # 3. Setup Lingkungan Pages
      - name: Setup Pages
        uses: actions/configure-pages@v4

      # 4. Gabungkan keduanya ke dalam satu folder 'public'
      - name: Merge Branches
        run: |
          mkdir public
          # Copy HRIS ke root (utama)
          cp -r hris-folder/* public/
          # Buat folder khusus 'gpro' dan copy isinya ke sana
          mkdir -p public/gpro
          cp -r gpro-folder/* public/gpro/

      # 5. Upload hasil penggabungan ke GitHub Pages
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: public/

      # 6. Deploy ke server
      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4
